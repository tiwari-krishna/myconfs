#!/bin/bash

# Directory where markdown files are stored
TODO_DIR="$HOME/Data/TODO"

# Check if the directory exists, if not, create it
if [ ! -d "$TODO_DIR" ]; then
    echo "Directory $TODO_DIR does not exist. Creating it..."
    mkdir -p "$TODO_DIR"
    if [ $? -ne 0 ]; then
        echo "Failed to create directory $TODO_DIR. Exiting."
        exit 1
    fi
fi

# Define the menu options
menu_options=$(find "$TODO_DIR" -name "*.md" -type f -exec basename {} \;)
menu_options+="\nCreate New File"

# List existing markdown files and add an option to create a new one
selected_file=$(echo -e "$menu_options" | fzf --prompt="Select or create a new file: " --preview "cat $TODO_DIR/{}" --preview-window=right:60%)
if [ -z "$selected_file" ]; then
    echo "No file selected. Exiting."
    exit 0
elif [ "$selected_file" == "Create New File" ]; then
    read -p "Enter the name for the new file (without .md extension): " new_file_name
    new_file="$TODO_DIR/$new_file_name.md"
    if [ -e "$new_file" ]; then
        echo "File already exists. Aborting."
        exit 1
    fi
    touch "$new_file"
    selected_file=$(basename "$new_file")
fi

# Open the selected or created file in nvim
nvim "$TODO_DIR/$selected_file"

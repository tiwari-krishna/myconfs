#!/usr/bin/env bash
set -euo pipefail

# --- Safety checks ---
if ! git rev-parse --is-inside-work-tree >/dev/null 2>&1; then
  echo "Error: Not inside a git repository."
  exit 1
fi

branch=$(git rev-parse --abbrev-ref HEAD)
if [ "$branch" = "HEAD" ]; then
  echo "Error: Detached HEAD state. Please checkout a branch."
  exit 1
fi

# --- Prepare commit message ---
msg="${1:-"Update"}"

# --- Stage changes ---
git add -A

# --- Ensure there is something to commit ---
if git diff --cached --quiet; then
  echo "No staged changes to commit."
  exit 0
fi

# --- Commit ---
echo "Committing to branch: $branch"
echo "Message: $msg"
git commit -m "$msg"

# --- Push ---
echo "Pushing branch '$branch' to origin..."
git push origin HEAD
echo "Done."
